<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCP Tools Tester | Xiaozhi</title>
    <meta name="description" content="Web interface for testing MCP (Model Context Protocol) agent tools">
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">
</head>

<body class="bg-[#0f0f14] text-zinc-100 min-h-screen leading-relaxed selection:bg-indigo-500/30">
    <div class="app-container grid grid-rows-[auto_1fr_auto] min-h-screen max-w-[1600px] mx-auto p-4 gap-4">
        <!-- Header -->
        <header
            class="header flex flex-col lg:flex-row justify-between items-center p-4 lg:px-6 bg-[#16161d]/70 backdrop-blur-xl border border-white/5 rounded-2xl gap-4">
            <div class="header-brand flex items-center gap-3">
                <div class="logo flex items-center justify-center">
                    <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                        <circle cx="16" cy="16" r="14" stroke="url(#gradient)" stroke-width="2" />
                        <path d="M10 16L14 20L22 12" stroke="url(#gradient)" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round" />
                        <defs>
                            <linearGradient id="gradient" x1="0" y1="0" x2="32" y2="32">
                                <stop offset="0%" stop-color="#6366f1" />
                                <stop offset="100%" stop-color="#8b5cf6" />
                            </linearGradient>
                        </defs>
                    </svg>
                </div>
                <h1
                    class="text-xl font-semibold bg-gradient-to-br from-indigo-500 to-violet-500 bg-clip-text text-transparent">
                    MCP Tools Tester</h1>
            </div>

            <div class="connection-panel flex items-center gap-4 flex-wrap w-full lg:w-auto flex-col sm:flex-row">
                <div class="connection-input-group flex gap-2 w-full sm:w-auto flex-col sm:flex-row">
                    <input type="text" id="ws-endpoint" placeholder="WebSocket Endpoint (ws://...)"
                        value="ws://localhost:8889"
                        class="input w-full sm:w-80 px-4 py-2.5 bg-[#1c1c26] border border-white/10 rounded-lg text-sm text-zinc-200 focus:outline-none focus:border-indigo-500/50 focus:shadow-[0_0_20px_rgba(99,102,241,0.2)] transition-all placeholder:text-zinc-600">
                    <button id="connect-btn"
                        class="btn btn-primary inline-flex items-center justify-center gap-2 px-5 py-2.5 bg-gradient-to-br from-indigo-500 to-violet-500 text-white rounded-lg font-medium text-sm hover:shadow-lg hover:shadow-indigo-500/20 hover:-translate-y-px transition-all border-0 cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed">
                        <span class="btn-icon">‚ö°</span>
                        Connect
                    </button>
                </div>
                <div class="connection-status flex items-center gap-2 px-4 py-2.5 bg-[#1c1c26] rounded-lg text-sm"
                    id="connection-status">
                    <span class="status-dot w-2.5 h-2.5 rounded-full bg-red-500 animate-pulse-custom"></span>
                    <span class="status-text text-zinc-400">Disconnected</span>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content grid grid-cols-1 lg:grid-cols-[240px_1fr_1fr] gap-4">
            <!-- Tool Selector Sidebar -->
            <aside
                class="sidebar bg-[#16161d]/70 backdrop-blur-xl border border-white/5 rounded-2xl p-4 flex flex-col h-full max-h-[calc(100vh-300px-76px-64px)] sticky top-4">
                <h2 class="sidebar-title text-xs font-semibold text-zinc-500 uppercase tracking-wider mb-4 px-2">
                    Available Tools</h2>
                <nav class="tool-nav flex flex-col gap-1 overflow-y-auto pr-2 custom-scrollbar flex-1">
                    <!-- Tools/Skeleton loaded via JS -->
                </nav>
            </aside>

            <!-- Tool Forms -->
            <section
                class="tool-panel bg-[#16161d]/70 backdrop-blur-xl border border-white/5 rounded-2xl p-6 h-full max-h-[calc(100vh-300px-76px-64px)] overflow-y-auto custom-scrollbar">
                <!-- Tool form dynamically rendered -->
            </section>

            <!-- Response Panel with Tabs -->
            <section
                class="response-panel flex flex-col relative bg-[#16161d]/70 backdrop-blur-xl border border-white/5 rounded-2xl h-full max-h-[100vh] md:max-h-[calc(100vh-300px-76px-64px)] overflow-hidden">
                <!-- Tab Navigation -->
                <div class="tab-navigation flex gap-1 p-2 bg-[#1c1c26] border-b border-white/5">
                    <button
                        class="tab-btn active flex items-center gap-2 px-4 py-2 rounded-lg text-zinc-400 text-sm font-medium hover:bg-[#16161d] hover:text-zinc-200 transition-all cursor-pointer"
                        data-tab="response">
                        <span class="tab-icon">üìã</span>
                        Response
                    </button>
                    <button
                        class="tab-btn flex items-center gap-2 px-4 py-2 rounded-lg text-zinc-400 text-sm font-medium hover:bg-[#16161d] hover:text-zinc-200 transition-all cursor-pointer"
                        data-tab="request">
                        <span class="tab-icon">üì§</span>
                        Request
                    </button>
                    <button
                        class="tab-btn flex items-center gap-2 px-4 py-2 rounded-lg text-zinc-400 text-sm font-medium hover:bg-[#16161d] hover:text-zinc-200 transition-all cursor-pointer"
                        data-tab="chat">
                        <span class="tab-icon">üí¨</span>
                        Chat
                    </button>
                </div>

                <!-- Response Tab Content -->
                <div class="tab-content active flex-col flex-1 min-h-0" id="response-tab">
                    <div class="panel-header flex justify-between items-center px-5 py-4 border-b border-white/5">
                        <h2 class="font-semibold text-base">Response</h2>
                        <button
                            class="btn btn-small btn-secondary inline-flex items-center justify-center px-3 py-1.5 bg-[#1c1c26] text-zinc-400 border border-white/10 rounded text-xs font-medium hover:bg-[#272732] hover:text-zinc-200 transition-all cursor-pointer"
                            onclick="clearResponse()">Clear</button>
                    </div>
                    <div class="response-content flex-1 p-4 overflow-y-auto custom-scrollbar" id="response-content">
                        <div
                            class="empty-state flex flex-col items-center justify-center h-full text-zinc-500 gap-4 min-h-[200px]">
                            <span class="empty-icon text-4xl opacity-50">üì≠</span>
                            <p class="text-sm">Execute a tool to see results here</p>
                        </div>
                    </div>
                </div>

                <!-- Request Tab Content -->
                <div class="tab-content hidden flex-col flex-1 min-h-0" id="request-tab">
                    <div class="panel-header flex justify-between items-center px-5 py-4 border-b border-white/5">
                        <h2 class="font-semibold text-base">Request</h2>
                        <button
                            class="btn btn-small btn-secondary inline-flex items-center justify-center px-3 py-1.5 bg-[#1c1c26] text-zinc-400 border border-white/10 rounded text-xs font-medium hover:bg-[#272732] hover:text-zinc-200 transition-all cursor-pointer"
                            onclick="clearRequest()">Clear</button>
                    </div>
                    <div class="response-content flex-1 p-4 overflow-y-auto custom-scrollbar" id="request-content">
                        <div
                            class="empty-state flex flex-col items-center justify-center h-full text-zinc-500 gap-4 min-h-[200px]">
                            <span class="empty-icon text-4xl opacity-50">üì§</span>
                            <p class="text-sm">Execute a tool to see request parameters here</p>
                        </div>
                    </div>
                </div>

                <!-- Chat Tab Content -->
                <div class="tab-content hidden flex-col flex-1 min-h-0" id="chat-tab">
                    <!-- Chat Header -->
                    <div class="chat-header flex justify-between items-center px-5 py-4 border-b border-white/5">
                        <h2 class="font-semibold text-base">Chat</h2>
                        <div class="flex gap-2">
                            <button
                                class="btn btn-small btn-secondary inline-flex items-center justify-center px-3 py-1.5 bg-[#1c1c26] text-zinc-400 border border-white/10 rounded text-xs font-medium hover:bg-[#272732] hover:text-zinc-200 transition-all cursor-pointer"
                                onclick="clearChat()">Clear</button>
                            <button
                                class="btn btn-small btn-secondary inline-flex items-center justify-center gap-2 px-3 py-1.5 bg-[#1c1c26] text-zinc-400 border border-white/10 rounded text-xs font-medium hover:bg-[#272732] hover:text-zinc-200 transition-all cursor-pointer"
                                id="chat-settings-btn">
                                <span class="btn-icon">‚öôÔ∏è</span>
                                Settings
                            </button>
                        </div>
                    </div>

                    <!-- Chat Body -->
                    <div class="chat-body flex-1 p-4 overflow-y-auto flex flex-col gap-3 custom-scrollbar"
                        id="chat-body">
                        <div class="empty-state flex flex-col items-center justify-center h-full text-zinc-500 gap-4">
                            <span class="empty-icon text-4xl opacity-50">üí¨</span>
                            <p class="text-sm">Start a conversation...</p>
                        </div>
                    </div>

                    <!-- Chat Footer -->
                    <div class="chat-footer p-4 border-t border-white/5 bg-[#1c1c26]">
                        <div class="chat-input-container flex items-end gap-2">
                            <textarea
                                class="chat-input flex-1 px-4 py-3 bg-[#16161d] border border-white/10 rounded-lg text-zinc-200 text-sm font-sans resize-none min-h-[44px] max-h-[120px] focus:outline-none focus:border-indigo-500/50 focus:shadow-[0_0_20px_rgba(99,102,241,0.2)] transition-all placeholder:text-zinc-600"
                                id="chat-input" placeholder="Type your message..." rows="1"></textarea>
                            <button
                                class="btn chat-send-btn p-3 min-w-[44px] h-[44px] bg-gradient-to-br from-indigo-500 to-violet-500 text-white rounded-lg flex items-center justify-center hover:scale-105 transition-transform cursor-pointer border-0"
                                id="chat-send-btn">
                                <span class="btn-icon text-lg">‚û§</span>
                            </button>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- Log Panel -->
        <aside
            class="log-panel bg-[#16161d]/70 backdrop-blur-xl border border-white/5 rounded-2xl flex flex-col max-h-[300px]">
            <div class="panel-header flex justify-between items-center px-4 py-3 border-b border-white/5">
                <h2 class="font-semibold text-sm">üìã Message Log</h2>
                <button
                    class="btn btn-small btn-secondary inline-flex items-center justify-center px-3 py-1.5 bg-[#1c1c26] text-zinc-400 border border-white/10 rounded text-xs font-medium hover:bg-[#272732] hover:text-zinc-200 transition-all cursor-pointer"
                    onclick="clearLogs()">Clear</button>
            </div>
            <div class="log-content flex-1 p-3 overflow-y-auto font-mono text-xs text-zinc-400" id="log-content">
                <div
                    class="log-entry flex gap-3 p-2 hover:bg-white/5 rounded mb-1 border-l-2 border-blue-500 bg-blue-500/5">
                    <span class="log-time opacity-70">--:--:--</span>
                    <span class="log-message text-blue-400">Ready to connect...</span>
                </div>
            </div>
        </aside>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal"
        class="hidden fixed inset-0 z-50 items-center justify-center p-4 bg-black/60 backdrop-blur-sm">
        <div
            class="relative w-full max-w-md bg-[#16161d] border border-white/10 rounded-2xl shadow-2xl shadow-black/50 overflow-hidden">
            <!-- Modal Header -->
            <div class="flex items-center justify-between px-6 py-4 border-b border-white/10">
                <h3 class="text-lg font-semibold text-zinc-100">Chat Settings</h3>
                <button onclick="closeSettingsModal()"
                    class="p-1 text-zinc-400 hover:text-zinc-200 transition-colors rounded-lg hover:bg-white/5">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12">
                        </path>
                    </svg>
                </button>
            </div>

            <!-- Modal Body -->
            <div class="p-6 space-y-4 max-h-[60vh] overflow-y-auto">
                <!-- Base URL -->
                <div class="space-y-2">
                    <label for="settings-base-url" class="block text-sm font-medium text-zinc-400">Base URL</label>
                    <input type="text" id="settings-base-url" placeholder="https://api.openai.com/v1"
                        class="w-full px-4 py-2.5 bg-[#1c1c26] border border-white/10 rounded-lg text-zinc-200 text-sm focus:outline-none focus:border-indigo-500/50 focus:shadow-[0_0_20px_rgba(99,102,241,0.2)] transition-all placeholder:text-zinc-600">
                </div>

                <!-- Token -->
                <div class="space-y-2">
                    <label for="settings-token" class="block text-sm font-medium text-zinc-400">API Token</label>
                    <input type="password" id="settings-token" placeholder="sk-..."
                        class="w-full px-4 py-2.5 bg-[#1c1c26] border border-white/10 rounded-lg text-zinc-200 text-sm focus:outline-none focus:border-indigo-500/50 focus:shadow-[0_0_20px_rgba(99,102,241,0.2)] transition-all placeholder:text-zinc-600">
                </div>

                <!-- Model -->
                <div class="space-y-2">
                    <label for="settings-model" class="block text-sm font-medium text-zinc-400">Model</label>
                    <div class="flex gap-2">
                        <select id="settings-model"
                            class="flex-1 px-4 pl-2 pr-6 bg-[#1c1c26] border border-white/10 rounded-lg text-zinc-200 text-sm focus:outline-none focus:border-indigo-500/50 focus:shadow-[0_0_20px_rgba(99,102,241,0.2)] transition-all">
                            <option value="">Select a model...</option>
                        </select>
                        <button id="settings-fetch-models-btn" onclick="fetchModels()"
                            class="px-4 py-2.5 bg-[#1c1c26] border border-white/10 rounded-lg text-zinc-400 text-sm font-medium hover:bg-[#272732] hover:text-zinc-200 transition-all cursor-pointer whitespace-nowrap">
                            Get Models
                        </button>
                    </div>
                </div>

                <!-- Max History -->
                <div class="space-y-2">
                    <label for="settings-max-history" class="block text-sm font-medium text-zinc-400">Max
                        History</label>
                    <input type="number" id="settings-max-history" min="1" max="100" value="20"
                        class="w-32 px-4 py-2.5 bg-[#1c1c26] border border-white/10 rounded-lg text-zinc-200 text-sm focus:outline-none focus:border-indigo-500/50 focus:shadow-[0_0_20px_rgba(99,102,241,0.2)] transition-all">
                    <p class="text-xs text-zinc-500">Maximum number of messages to keep in context</p>
                </div>

                <!-- Tool Selection -->
                <div class="space-y-3">
                    <label class="block text-sm font-medium text-zinc-400">Tool Selection</label>

                    <!-- Radio Options -->
                    <div class="flex gap-4">
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="radio" name="tool-mode" value="selected" id="tool-mode-selected" checked
                                class="w-4 h-4 accent-indigo-500" onchange="toggleCustomToolsPanel()">
                            <span class="text-sm text-zinc-300">Use selected tool</span>
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="radio" name="tool-mode" value="custom" id="tool-mode-custom"
                                class="w-4 h-4 accent-indigo-500" onchange="toggleCustomToolsPanel()">
                            <span class="text-sm text-zinc-300">Custom tools</span>
                        </label>
                    </div>

                    <!-- Custom Tools Panel (hidden by default) -->
                    <div id="custom-tools-panel" class="hidden space-y-2">
                        <p class="text-xs text-zinc-500">Select tools to use in chat:</p>
                        <div id="custom-tools-list"
                            class="max-h-[150px] overflow-y-auto bg-[#1c1c26] border border-white/10 rounded-lg p-2 space-y-1">
                            <p class="text-xs text-zinc-500 italic">Connect to MCP to see available tools</p>
                        </div>
                    </div>
                </div>

                <!-- System Prompt -->
                <div class="space-y-2">
                    <label for="settings-system-prompt" class="block text-sm font-medium text-zinc-400">System
                        Prompt</label>
                    <textarea id="settings-system-prompt" rows="4" placeholder="You are a helpful assistant..."
                        class="w-full px-4 py-2.5 bg-[#1c1c26] border border-white/10 rounded-lg text-zinc-200 text-sm focus:outline-none focus:border-indigo-500/50 focus:shadow-[0_0_20px_rgba(99,102,241,0.2)] transition-all placeholder:text-zinc-600 resize-y min-h-[100px]"></textarea>
                </div>
            </div>

            <!-- Modal Footer -->
            <div class="flex items-center justify-end gap-3 px-6 py-4 border-t border-white/10 bg-[#1c1c26]/50">
                <button onclick="closeSettingsModal()"
                    class="px-4 py-2 bg-[#1c1c26] border border-white/10 rounded-lg text-zinc-400 text-sm font-medium hover:bg-[#272732] hover:text-zinc-200 transition-all cursor-pointer">
                    Cancel
                </button>
                <button onclick="saveSettings()"
                    class="px-4 py-2 bg-gradient-to-br from-indigo-500 to-violet-500 text-white rounded-lg text-sm font-medium hover:shadow-lg hover:shadow-indigo-500/20 transition-all cursor-pointer">
                    Save
                </button>
            </div>
        </div>
    </div>

    <!-- Markdown Parser -->
    <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js"></script>

    <!-- JavaScript Modules -->
    <script src="js/state.js"></script>
    <script src="js/ui-utils.js"></script>
    <script src="js/websocket.js"></script>
    <script src="js/mcp-protocol.js"></script>
    <script src="js/tools.js"></script>
    <script src="js/tts.js"></script>
    <script src="js/tabs.js"></script>
    <script src="js/chat-api.js"></script>
    <script src="js/settings.js"></script>
    <script src="app.js"></script>
</body>

</html>